<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript 構文入門</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        .code-font {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        }
        /* --- Token Interactivity --- */
        .interactive-code span {
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .interactive-code span:hover {
            background-color: #4A5568; /* gray-700 */
        }
        .highlight {
            background-color: #2c5282; /* blue-800 */
            color: white;
        }
        
        /* --- Structure Interactivity --- */
        .highlightable {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border-radius: 6px;
            border: 2px solid transparent;
            padding: 4px 2px;
        }
        .highlight-statement { border-color: #F6E05E !important; background-color: rgba(246, 224, 94, 0.15) !important; }
        .highlight-expression { border-color: #68D391 !important; background-color: rgba(104, 211, 145, 0.15) !important; }
        .highlight-member-expression { border-color: #9F7AEA !important; background-color: rgba(159, 122, 234, 0.15) !important; }
        .highlight-identifier { border-color: #4FD1C5 !important; background-color: rgba(79, 209, 197, 0.15) !important; }
        .highlight-literal { border-color: #F6AD55 !important; background-color: rgba(246, 173, 85, 0.15) !important; }
        .highlight-clause { border-color: #ED64A6 !important; background-color: rgba(237, 100, 166, 0.15) !important; }
        .highlight-keyword { border-color: #ECC94B !important; background-color: rgba(236, 201, 75, 0.15) !important; }

        /* --- AST Tree Styles --- */
        .ast-tree, .ast-tree ul { position: relative; padding-left: 20px; list-style: none; }
        .ast-tree-node { position: relative; padding: 2px 0; }
        .ast-tree-node::before { content: ""; position: absolute; top: 0; left: -20px; width: 2px; height: 100%; background-color: #4A5568; }
        .ast-tree-node::after { content: ""; position: absolute; top: 15px; left: -20px; width: 20px; height: 2px; background-color: #4A5568; }
        .ast-tree-root > .ast-tree-node::before, .ast-tree-root > .ast-tree-node::after { display: none; }
        .ast-tree-node:last-child::before { height: 15px; }
        .ast-tree-node .node-content { display: inline-block; cursor: pointer; padding: 4px 8px; border-radius: 6px; border: 2px solid transparent; transition: all 0.2s ease-in-out; margin: 0; }
        .ast-tree .node-type { font-weight: bold; color: #63B3ED; }
        .ast-tree .node-value { color: #90CDF4; }
        .ast-tree .node-prop { color: #F6E05E; }

        /* --- Tab Styles --- */
        .tab-button, .tab-button-advanced {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border: none;
            background: none;
            color: #A0AEC0; /* gray-500 */
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active, .tab-button-advanced.active {
            color: #E2E8F0; /* gray-200 */
            border-bottom-color: #63B3ED; /* blue-400 */
        }
        .tab-pane, .advanced-tab-pane { display: none; }
        .tab-pane.active, .advanced-tab-pane.active { display: block; }

        /* --- Badge Styles --- */
        .badge {
            display: inline-block;
            padding: 2px 10px;
            font-size: 0.75rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 9999px;
        }
        .badge-statement { color: #1A202C; background-color: #F6E05E; }
        .badge-expression { color: #1A202C; background-color: #68D391; }
        .badge-clause { color: #1A202C; background-color: #ED64A6; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center min-h-screen p-4 sm:p-8">

    <main class="w-full max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white mb-2">JavaScript 構文入門</h1>
            <p class="text-lg text-gray-400">JavaScript の構文を構成する構造や部品を理解しよう</p>
        </header>

        <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">はじめに</h2>
                    <p class="text-sm text-blue-300 font-medium">コードの階層構造</p>
                </div>
            </div>
            <p class="text-gray-400 mb-4">プログラムは、大きな構造から小さな部品へと分解できます。この関係を知ると、コードの見え方が変わります。</p>
            <ul class="space-y-3 text-gray-300">
                <li><strong class="text-yellow-400 text-lg">文 (Statement):</strong> コンピュータへの1つの「命令」。「〜せよ」で終わる文章のようなもの。</li>
                <li><strong class="text-green-400 text-lg">式 (Expression):</strong> 評価すると1つの「値」になるかたまり。計算式や関数呼び出しなど。文の一部であることが多い。</li>
                <li><strong class="text-pink-400 text-lg">節 (Clause):</strong> <code class="code-font bg-gray-600 px-1 rounded">if</code>文の<code class="code-font bg-gray-600 px-1 rounded">if</code>節や<code class="code-font bg-gray-600 px-1 rounded">else</code>節のように、文の構造を構成するキーワードで始まる意味のまとまり。</li>
                <li><strong class="text-teal-400 text-lg">トークン (Token):</strong> これ以上分解できない最小単位の「単語」や「記号」。</li>
            </ul>
        </section>

        <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">ステップ 1</h2>
                    <p class="text-sm text-green-300 font-medium">部品（トークン）の役割を知る</p>
                </div>
            </div>
            <p class="text-gray-400 mb-6"><code class="code-font bg-gray-600 px-1 rounded">console.log('Hello, world!');</code> の各部分にマウスカーソルを合わせてみてください。</p>
            <div class="bg-black rounded-lg p-4 text-xl sm:text-2xl code-font interactive-code mb-4 text-center" id="code-container">
                <span id="token-console" class="text-sky-400">console</span><span id="token-dot" class="text-gray-500">.</span><span id="token-log" class="text-yellow-400">log</span><span id="token-parens-open" class="text-gray-500">(</span><span id="token-string" class="text-green-400">'Hello, world!'</span><span id="token-parens-close" class="text-gray-500">)</span><span id="token-semicolon" class="text-gray-500">;</span>
            </div>
            <div id="explanation-box" class="bg-gray-700 p-5 rounded-lg h-36">
                <p class="text-gray-300">ここに解説が表示されます。</p>
            </div>
        </section>

        <div id="interactive-sync-area-simple">
            <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8" id="structure-section">
                <div class="flex items-center mb-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">ステップ 2</h2>
                        <p class="text-sm text-yellow-300 font-medium">単純な構造（文と式）を理解する</p>
                    </div>
                </div>
                <p class="text-gray-400 mb-6">コードのまとまりにカーソルを合わせると、その構造がわかります。下のステップ3のツリーも連動して光ります。</p>
                <div class="bg-black rounded-lg p-6 text-xl sm:text-2xl code-font interactive-structure text-center" id="structure-container-simple">
                    <span id="simple-struct-statement" class="highlightable">
                        <span id="simple-struct-expression" class="highlightable">
                            <span id="simple-struct-member-expression" class="highlightable"><span id="simple-struct-identifier-console" class="highlightable"><span class="text-sky-400">console</span></span><span class="text-gray-500">.</span><span id="simple-struct-identifier-log" class="highlightable"><span class="text-yellow-400">log</span></span></span><span class="text-gray-500">(</span><span id="simple-struct-literal" class="highlightable"><span class="text-green-400">'Hello, world!'</span></span><span class="text-gray-500">)</span>
                        </span><span class="text-gray-500">;</span>
                    </span>
                </div>
                <div id="structure-explanation-box-simple" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                    <p class="text-gray-300">ここに解説が表示されます。</p>
                </div>
            </section>
            <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8" id="ast-section-simple">
                <div class="flex items-center mb-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">ステップ 3</h2>
                        <p class="text-sm text-purple-300 font-medium">コンピュータの視点 (単純な構文木)</p>
                    </div>
                </div>
                <p class="text-gray-400 mb-6">コンピュータはコードをこの「木」の形で理解します。ツリーの各部分に触れると、ステップ2のコードも連動します。</p>
                <div class="bg-black p-4 rounded-lg code-font">
                    <ul class="ast-tree ast-tree-root">
                        <li class="ast-tree-node">
                            <div class="node-content" id="simple-ast-statement"><span class="node-type">文 (ExpressionStatement)</span></div>
                            <ul class="ast-tree">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="simple-ast-expression"><span class="node-type">式 (CallExpression)</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="simple-ast-callee"><span class="node-prop">呼び出すもの (callee)</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="simple-ast-member-expression"><span class="node-type">式 (MemberExpression)</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node"><div class="node-content" id="simple-ast-identifier-console"><span class="node-prop">対象:</span> <span class="node-value">Identifier "console"</span></div></li>
                                                        <li class="ast-tree-node"><div class="node-content" id="simple-ast-identifier-log"><span class="node-prop">メンバー:</span> <span class="node-value">Identifier "log"</span></div></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="simple-ast-arguments"><span class="node-prop">引数 (arguments)</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node"><div class="node-content" id="simple-ast-literal"><span class="node-type">値 (Literal):</span> <span class="node-value">'Hello, world!'</span></div></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </section>
        </div>

        <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-blue-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">ステップ 4</h2>
                    <p class="text-sm text-indigo-300 font-medium">制御構文を分解する</p>
                </div>
            </div>
            <p class="text-gray-400 mb-6">条件分岐や繰り返しなど、より複雑な命令の構造を見てみましょう。タブで切り替えてください。</p>
            <div class="flex border-b border-gray-700 mb-6">
                <button data-tab="if-statement" class="tab-button active">if 文</button>
                <button data-tab="for-loop" class="tab-button">for ループ</button>
                <button data-tab="switch-statement" class="tab-button">switch 文</button>
            </div>
            <div id="tab-content">
                <!-- If Statement Example -->
                <div id="if-statement" class="tab-pane active">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-if">
                                <div id="if-struct-statement" class="highlightable inline-block text-left">
                                    <div>
                                        <span class="highlightable" id="if-struct-keyword-if"><span class="text-pink-400">if</span></span><span class="text-gray-500"> (</span><span class="highlightable" id="if-struct-test1"><span class="text-sky-400">score</span><span class="text-pink-400"> >= </span><span class="text-teal-300">80</span></span><span class="text-gray-500">) </span><span class="highlightable" id="if-struct-consequent1"><span class="text-gray-500">{ ... }</span></span>
                                    </div>
                                    <div class="highlightable" id="if-struct-alternate">
                                        <span class="highlightable" id="if-struct-keyword-else-if"><span class="text-pink-400">else if</span></span><span class="text-gray-500"> (</span><span class="highlightable" id="if-struct-test2"><span class="text-sky-400">score</span><span class="text-pink-400"> >= </span><span class="text-teal-300">60</span></span><span class="text-gray-500">) </span><span class="highlightable" id="if-struct-consequent2"><span class="text-gray-500">{ ... }</span></span>
                                        <div class="highlightable" id="if-struct-alternate-final-group">
                                            <span class="highlightable" id="if-struct-keyword-else"><span class="text-pink-400">else</span></span> <span class="highlightable" id="if-struct-final-alternate"><span class="text-gray-500">{ ... }</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="structure-explanation-box-if" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                            <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/if...else" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">MDNで詳しく見る &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                            <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="if-ast-statement"><span class="node-type">IfStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node"><div class="node-content" id="if-ast-test1"><span class="node-prop">test:</span> <span class="node-value">BinaryExpression</span></div></li>
                                        <li class="ast-tree-node"><div class="node-content" id="if-ast-consequent1"><span class="node-prop">consequent:</span> <span class="node-value">BlockStatement</span></div></li>
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="if-ast-alternate"><span class="node-prop">alternate:</span> <span class="node-type">IfStatement</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node"><div class="node-content" id="if-ast-test2"><span class="node-prop">test:</span> <span class="node-value">BinaryExpression</span></div></li>
                                                <li class="ast-tree-node"><div class="node-content" id="if-ast-consequent2"><span class="node-prop">consequent:</span> <span class="node-value">BlockStatement</span></div></li>
                                                <li class="ast-tree-node"><div class="node-content" id="if-ast-final-alternate"><span class="node-prop">alternate:</span> <span class="node-value">BlockStatement</span></div></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- For Loop Example -->
                <div id="for-loop" class="tab-pane">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-for">
                                <span id="for-struct-statement" class="highlightable">
                                    <span class="highlightable" id="for-struct-keyword"><span class="text-pink-400">for</span></span><span class="text-gray-500"> (</span><span class="highlightable" id="for-struct-init"><span class="text-pink-400">let</span><span class="text-sky-400"> i</span><span class="text-pink-400"> = </span><span class="text-teal-300">0</span></span><span class="text-gray-500">; </span><span class="highlightable" id="for-struct-test"><span class="text-sky-400">i</span><span class="text-pink-400"> < </span><span class="text-teal-300">5</span></span><span class="text-gray-500">; </span><span class="highlightable" id="for-struct-update"><span class="text-sky-400">i</span><span class="text-pink-400">++</span></span><span class="text-gray-500">) </span><span class="highlightable" id="for-struct-body"><span class="text-gray-500">{ ... }</span></span>
                                </span>
                            </div>
                            <div id="structure-explanation-box-for" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                             <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/for" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">MDNで詳しく見る &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                           <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="for-ast-statement"><span class="node-type">ForStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node"><div class="node-content" id="for-ast-init"><span class="node-prop">init:</span> <span class="node-value">VariableDeclaration</span></div></li>
                                        <li class="ast-tree-node"><div class="node-content" id="for-ast-test"><span class="node-prop">test:</span> <span class="node-value">BinaryExpression</span></div></li>
                                        <li class="ast-tree-node"><div class="node-content" id="for-ast-update"><span class="node-prop">update:</span> <span class="node-value">UpdateExpression</span></div></li>
                                        <li class="ast-tree-node"><div class="node-content" id="for-ast-body"><span class="node-prop">body:</span> <span class="node-value">BlockStatement</span></div></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Switch Statement Example -->
                <div id="switch-statement" class="tab-pane">
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-switch">
                                <div id="switch-struct-statement" class="highlightable inline-block text-left">
                                    <span class="highlightable" id="switch-struct-keyword-switch"><span class="text-pink-400">switch</span></span><span class="text-gray-500"> (</span><span class="highlightable" id="switch-struct-discriminant"><span class="text-sky-400">fruit</span></span><span class="text-gray-500">) {</span>
                                    <div class="pl-4">
                                        <span class="highlightable" id="switch-struct-case1">
                                            <span class="highlightable" id="switch-struct-keyword-case1"><span class="text-pink-400">case</span></span> <span class="highlightable" id="switch-struct-test1"><span class="text-green-400">'apple'</span></span><span class="text-gray-500">: ...; </span><span class="highlightable" id="switch-struct-break1"><span class="text-pink-400">break</span><span class="text-gray-500">;</span></span>
                                        </span>
                                        <br>
                                        <span class="highlightable" id="switch-struct-case2">
                                            <span class="highlightable" id="switch-struct-keyword-case2"><span class="text-pink-400">case</span></span> <span class="highlightable" id="switch-struct-test2"><span class="text-green-400">'orange'</span></span><span class="text-gray-500">: ...; </span><span class="highlightable" id="switch-struct-break2"><span class="text-pink-400">break</span><span class="text-gray-500">;</span></span>
                                        </span>
                                        <br>
                                        <span class="highlightable" id="switch-struct-default">
                                            <span class="highlightable" id="switch-struct-keyword-default"><span class="text-pink-400">default</span></span><span class="text-gray-500">: ...;</span>
                                        </span>
                                    </div>
                                    <span class="text-gray-500">}</span>
                                </div>
                            </div>
                            <div id="structure-explanation-box-switch" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                            <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/switch" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">MDNで詳しく見る &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                           <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="switch-ast-statement"><span class="node-type">SwitchStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node"><div class="node-content" id="switch-ast-discriminant"><span class="node-prop">discriminant:</span> <span class="node-value">Identifier "fruit"</span></div></li>
                                        <li class="ast-tree-node">
                                            <div class="node-content"><span class="node-prop">cases:</span> <span class="node-value">[...]</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="switch-ast-case1"><span class="node-type">SwitchCase</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node"><div class="node-content" id="switch-ast-test1"><span class="node-prop">test:</span> <span class="node-value">Literal 'apple'</span></div></li>
                                                        <li class="ast-tree-node"><div class="node-content" id="switch-ast-break1"><span class="node-type">BreakStatement</span></div></li>
                                                    </ul>
                                                </li>
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="switch-ast-case2"><span class="node-type">SwitchCase</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node"><div class="node-content" id="switch-ast-test2"><span class="node-prop">test:</span> <span class="node-value">Literal 'orange'</span></div></li>
                                                         <li class="ast-tree-node"><div class="node-content" id="switch-ast-break2"><span class="node-type">BreakStatement</span></div></li>
                                                    </ul>
                                                </li>
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="switch-ast-default"><span class="node-type">SwitchCase (default)</span></div>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-8">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">ステップ 5</h2>
                    <p class="text-sm text-red-300 font-medium">応用的な構文パターン</p>
                </div>
            </div>
            <p class="text-gray-400 mb-6">基本を理解したら、より複雑で実用的なパターンを見てみましょう。expressionが入れ子になることで、柔軟なコードが書けるようになります。</p>
            <div class="flex border-b border-gray-700 mb-6">
                <button data-tab="chained-calls" class="tab-button-advanced active">メソッドチェーン</button>
                <button data-tab="higher-order" class="tab-button-advanced">高階関数</button>
                <button data-tab="dynamic-access" class="tab-button-advanced">動的アクセス</button>
            </div>
            <div id="advanced-tab-content">
                <!-- Method Chaining Example -->
                <div id="chained-calls" class="advanced-tab-pane active">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-chained">
                                <div id="chained-struct-statement" class="highlightable inline-block text-left">
                                    <span class="highlightable" id="chained-struct-full-expression">
                                        <span class="highlightable" id="chained-struct-map-callee">
                                            <span class="highlightable" id="chained-struct-filter-call">
                                                <span class="highlightable" id="chained-struct-filter-member">
                                                    <span class="highlightable" id="chained-struct-object"><span class="text-sky-400">users</span></span><span class="text-gray-500">.</span><span class="highlightable" id="chained-struct-filter-property"><span class="text-yellow-400">filter</span></span>
                                                </span><span class="text-gray-500">(</span><span class="highlightable" id="chained-struct-filter-arg"><span class="text-sky-400">u</span><span class="text-pink-400"> => </span><span class="text-sky-400">u</span><span class="text-gray-500">.</span><span class="text-yellow-400">active</span></span><span class="text-gray-500">)</span>
                                            </span>
                                            <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="text-gray-500">.</span><span class="highlightable" id="chained-struct-map-member"><span class="text-yellow-400">map</span></span>
                                        </span><span class="text-gray-500">(</span><span class="highlightable" id="chained-struct-map-arg"><span class="text-sky-400">u</span><span class="text-pink-400"> => </span><span class="text-sky-400">u</span><span class="text-gray-500">.</span><span class="text-yellow-400">name</span></span><span class="text-gray-500">)</span>
                                    </span><span class="text-gray-500">;</span>
                                </div>
                            </div>
                            <div id="structure-explanation-box-chained" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                            <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">配列メソッドについて詳しく &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                            <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="chained-ast-statement"><span class="node-type">ExpressionStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="chained-ast-full-expression"><span class="node-type">CallExpression</span> <span class="text-xs text-gray-400">(map呼び出し)</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="chained-ast-map-callee"><span class="node-prop">callee:</span> <span class="node-type">MemberExpression</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node">
                                                            <div class="node-content" id="chained-ast-filter"><span class="node-prop">object:</span> <span class="node-type">CallExpression</span> <span class="text-xs text-gray-400">(filter呼び出し)</span></div>
                                                            <ul class="ast-tree">
                                                                <li class="ast-tree-node">
                                                                    <div class="node-content" id="chained-ast-filter-callee"><span class="node-prop">callee:</span> <span class="node-type">MemberExpression</span></div>
                                                                    <ul class="ast-tree">
                                                                        <li class="ast-tree-node"><div class="node-content" id="chained-ast-object"><span class="node-prop">object:</span> <span class="node-value">Identifier "users"</span></div></li>
                                                                        <li class="ast-tree-node"><div class="node-content" id="chained-ast-filter-property"><span class="node-prop">property:</span> <span class="node-value">Identifier "filter"</span></div></li>
                                                                    </ul>
                                                                </li>
                                                                <li class="ast-tree-node"><div class="node-content" id="chained-ast-filter-arg"><span class="node-prop">arguments:</span> <span class="node-value">[ArrowFunction]</span></div></li>
                                                            </ul>
                                                        </li>
                                                        <li class="ast-tree-node"><div class="node-content" id="chained-ast-map-property"><span class="node-prop">property:</span> <span class="node-value">Identifier "map"</span></div></li>
                                                    </ul>
                                                </li>
                                                <li class="ast-tree-node"><div class="node-content" id="chained-ast-map-arg"><span class="node-prop">arguments:</span> <span class="node-value">[ArrowFunction]</span></div></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Higher-order Function Example -->
                <div id="higher-order" class="advanced-tab-pane">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-higher">
                                <div id="higher-struct-statement" class="highlightable inline-block text-left">
                                    <span class="highlightable" id="higher-struct-full-expression">
                                        <span class="highlightable" id="higher-struct-callee">
                                            <span class="highlightable" id="higher-struct-get-handler"><span class="text-yellow-400">getEventHandler</span></span><span class="text-gray-500">(</span><span class="highlightable" id="higher-struct-handler-arg"><span class="text-green-400">'click'</span></span><span class="text-gray-500">)</span>
                                        </span>
                                        <span class="text-gray-500">(</span><span class="highlightable" id="higher-struct-event-arg"><span class="text-sky-400">event</span></span><span class="text-gray-500">)</span>
                                    </span><span class="text-gray-500">;</span>
                                </div>
                            </div>
                            <div id="structure-explanation-box-higher" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                            <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Glossary/First-class_Function" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">高階関数について詳しく &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                            <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="higher-ast-statement"><span class="node-type">ExpressionStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="higher-ast-full-expression"><span class="node-type">CallExpression</span> <span class="text-xs text-gray-400">(戻り値の関数を実行)</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="higher-ast-callee"><span class="node-prop">callee:</span> <span class="node-type">CallExpression</span> <span class="text-xs text-gray-400">(関数を取得)</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node"><div class="node-content" id="higher-ast-get-handler"><span class="node-prop">callee:</span> <span class="node-value">Identifier "getEventHandler"</span></div></li>
                                                        <li class="ast-tree-node"><div class="node-content" id="higher-ast-handler-arg"><span class="node-prop">arguments:</span> <span class="node-value">[StringLiteral 'click']</span></div></li>
                                                    </ul>
                                                </li>
                                                <li class="ast-tree-node"><div class="node-content" id="higher-ast-event-arg"><span class="node-prop">arguments:</span> <span class="node-value">[Identifier "event"]</span></div></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Access Example -->
                <div id="dynamic-access" class="advanced-tab-pane">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-black rounded-lg p-4 code-font text-lg interactive-structure text-center" id="structure-container-dynamic">
                                <div id="dynamic-struct-statement" class="highlightable inline-block text-left">
                                    <span class="highlightable" id="dynamic-struct-full-expression">
                                        <span class="highlightable" id="dynamic-struct-callee">
                                            <span class="highlightable" id="dynamic-struct-object"><span class="text-sky-400">obj</span></span>
                                            <span class="text-gray-500">[</span>
                                            <span class="highlightable" id="dynamic-struct-property">
                                                <span class="highlightable" id="dynamic-struct-method-name"><span class="text-green-400">'get'</span></span>
                                                <span class="text-pink-400"> + </span>
                                                <span class="highlightable" id="dynamic-struct-capitalize">
                                                    <span class="highlightable" id="dynamic-struct-capitalize-callee"><span class="text-yellow-400">capitalize</span></span><span class="text-gray-500">(</span><span class="highlightable" id="dynamic-struct-field-arg"><span class="text-sky-400">field</span></span><span class="text-gray-500">)</span>
                                                </span>
                                            </span>
                                            <span class="text-gray-500">]</span>
                                        </span><span class="text-gray-500">(</span><span class="highlightable" id="dynamic-struct-arguments"><span class="text-teal-300">42</span></span><span class="text-gray-500">)</span>
                                    </span><span class="text-gray-500">;</span>
                                </div>
                            </div>
                            <div id="structure-explanation-box-dynamic" class="bg-gray-700 p-5 rounded-lg h-48 mt-6">
                                <p class="text-gray-300">ここに解説が表示されます。</p>
                            </div>
                            <div class="mt-4 text-right">
                                <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Property_accessors" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">プロパティアクセサについて詳しく &rarr;</a>
                            </div>
                        </div>
                        <div class="bg-black p-4 rounded-lg code-font">
                            <ul class="ast-tree ast-tree-root">
                                <li class="ast-tree-node">
                                    <div class="node-content" id="dynamic-ast-statement"><span class="node-type">ExpressionStatement</span></div>
                                    <ul class="ast-tree">
                                        <li class="ast-tree-node">
                                            <div class="node-content" id="dynamic-ast-full-expression"><span class="node-type">CallExpression</span></div>
                                            <ul class="ast-tree">
                                                <li class="ast-tree-node">
                                                    <div class="node-content" id="dynamic-ast-callee"><span class="node-prop">callee:</span> <span class="node-type">MemberExpression</span> <span class="text-xs text-gray-400">(computed)</span></div>
                                                    <ul class="ast-tree">
                                                        <li class="ast-tree-node"><div class="node-content" id="dynamic-ast-object"><span class="node-prop">object:</span> <span class="node-value">Identifier "obj"</span></div></li>
                                                        <li class="ast-tree-node">
                                                            <div class="node-content" id="dynamic-ast-property"><span class="node-prop">property:</span> <span class="node-type">BinaryExpression</span> <span class="text-xs text-gray-400">(+)</span></div>
                                                            <ul class="ast-tree">
                                                                <li class="ast-tree-node"><div class="node-content" id="dynamic-ast-method-name"><span class="node-prop">left:</span> <span class="node-value">StringLiteral 'get'</span></div></li>
                                                                <li class="ast-tree-node">
                                                                    <div class="node-content" id="dynamic-ast-capitalize"><span class="node-prop">right:</span> <span class="node-type">CallExpression</span></div>
                                                                    <ul class="ast-tree">
                                                                        <li class="ast-tree-node"><div class="node-content" id="dynamic-ast-capitalize-callee"><span class="node-prop">callee:</span> <span class="node-value">Identifier "capitalize"</span></div></li>
                                                                        <li class="ast-tree-node"><div class="node-content" id="dynamic-ast-field-arg"><span class="node-prop">arguments:</span> <span class="node-value">[Identifier "field"]</span></div></li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li class="ast-tree-node"><div class="node-content" id="dynamic-ast-arguments"><span class="node-prop">arguments:</span> <span class="node-value">[NumericLiteral 42]</span></div></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer style="text-align: center; color: #aaaaaa;">
            Generated by Gemini 2.5 Pro
        </footer>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Token-level Script ---
            const tokenExplanations = {
                console: { title: '`console` オブジェクト', text: 'ブラウザの開発者ツール（コンソール）を操作するための機能が詰まった「道具箱」のようなものです。専門用語では「オブジェクト」と呼びます。' },
                dot: { title: '`.` (ドット演算子)', text: '「〜の」という意味で、左側のオブジェクトが持っている機能やデータにアクセスするために使います。ここでは「consoleの〜」という意味になります。' },
                log: { title: '`log` メソッド (関数)', text: '`console` オブジェクトが持っている機能の一つで、コンソールにメッセージを記録（log）するためのものです。専門用語では「メソッド」や「関数」と呼びます。' },
                'parens-open': { title: '`(` (丸括弧の始まり)', text: '関数を実行（呼び出す）ための合図です。この括弧の中に、関数に渡したい情報（引数）を書きます。' },
                'parens-close': { title: '`)` (丸括弧の終わり)', text: '関数呼び出しの終わりを示します。' },
                string: { title: '`\'Hello, world!\'` (文字列リテラル)', text: '`log`関数に渡しているデータです。クォーテーションで囲まれた文字の並びを「文字列」と呼びます。これがコンソールに表示される内容になります。' },
                semicolon: { title: '`;` (セミコロン)', text: '文の終わりを示す記号です。これによって、コンピュータは一つの命令がどこで終わるのかを正確に理解できます。' }
            };
            const explanationBox = document.getElementById('explanation-box');
            const codeContainer = document.getElementById('code-container');
            const tokenSpans = codeContainer.querySelectorAll('span');
            const tokenDefaultText = '<p class="text-gray-300">ここに解説が表示されます。</p>';
            explanationBox.innerHTML = tokenDefaultText;
            tokenSpans.forEach(span => {
                span.addEventListener('mouseover', (e) => {
                    tokenSpans.forEach(s => s.classList.remove('highlight'));
                    e.target.classList.add('highlight');
                    const id = e.target.id.replace('token-', '');
                    const explanation = tokenExplanations[id];
                    if (explanation) {
                        const processedTitle = explanation.title.replace(/`([^`]+)`/g, '<code class="code-font bg-gray-600 px-1 rounded">$1</code>');
                        const processedText = explanation.text.replace(/`([^`]+)`/g, '<code class="code-font bg-gray-600 px-1 rounded">$1</code>');
                        explanationBox.innerHTML = `<h3 class="text-lg font-bold text-white mb-2">${processedTitle}</h3><p class="text-gray-300">${processedText}</p>`;
                    }
                });
            });
            codeContainer.addEventListener('mouseout', () => {
                tokenSpans.forEach(s => s.classList.remove('highlight'));
                explanationBox.innerHTML = tokenDefaultText;
            });

            // --- Generic Interactive Setup (REVISED) ---
            const setupInteractiveArea = (areaId, definitions) => {
                // For advanced tabs, search within the specific advanced tab pane
                let syncArea = document.getElementById(areaId);
                if (!syncArea) {
                    // If not found directly, search within advanced tab panes
                    const advancedPanes = document.querySelectorAll('.advanced-tab-pane');
                    for (const pane of advancedPanes) {
                        if (pane.id === areaId) {
                            syncArea = pane;
                            break;
                        }
                    }
                }
                if (!syncArea) return;

                const structureExplanationBox = syncArea.querySelector('[id^="structure-explanation-box"]');
                const structureDefaultText = '<p class="text-gray-300">ここに解説が表示されます。</p>';

                const idToKeyMap = {};
                for (const key in definitions) {
                    const def = definitions[key];
                    if (def.structId) idToKeyMap[def.structId] = key;
                    if (def.astId) idToKeyMap[def.astId] = key;
                }

                const clearHighlights = () => {
                    for (const key in definitions) {
                        const def = definitions[key];
                        if (def.structId) {
                            const codeSpan = syncArea.querySelector(`#${def.structId}`);
                            if (codeSpan && def.highlightClass) codeSpan.classList.remove(def.highlightClass);
                        }
                        if (def.astId) {
                            const astNode = syncArea.querySelector(`#${def.astId}`);
                            if (astNode) {
                                astNode.style.borderColor = 'transparent';
                                astNode.style.backgroundColor = 'transparent';
                            }
                        }
                    }
                };

                const highlightPair = (hoveredId) => {
                    clearHighlights();
                    if (!hoveredId) {
                        if (structureExplanationBox) structureExplanationBox.innerHTML = structureDefaultText;
                        return;
                    }

                    const key = idToKeyMap[hoveredId];
                    if (!key) return;

                    const def = definitions[key];
                    if (!def) return;

                    if (def.structId) {
                        const codeSpan = syncArea.querySelector(`#${def.structId}`);
                        if (codeSpan && def.highlightClass) codeSpan.classList.add(def.highlightClass);
                    }
                    if (def.astId) {
                        const astNode = syncArea.querySelector(`#${def.astId}`);
                        if (astNode && def.color) {
                            astNode.style.borderColor = def.color;
                            const r = parseInt(def.color.slice(1, 3), 16);
                            const g = parseInt(def.color.slice(3, 5), 16);
                            const b = parseInt(def.color.slice(5, 7), 16);
                            astNode.style.backgroundColor = `rgba(${r}, ${g}, ${b}, 0.15)`;
                        }
                    }
                    
                    if (structureExplanationBox) {
                        const badgeHtml = def.badge ? `<span class="badge ${def.badgeClass}">${def.badge}</span>` : '';
                        const titleMarginClass = def.badge ? 'ml-3' : '';
                        const processedTitle = def.title.replace(/`([^`]+)`/g, '<code class="code-font bg-gray-600 px-1 rounded">$1</code>');
                        const processedText = def.text.replace(/`([^`]+)`/g, '<code class="code-font bg-gray-600 px-1 rounded">$1</code>');
                        structureExplanationBox.innerHTML = `
                            <div class="flex items-center mb-2">
                                ${badgeHtml}
                                <h3 class="text-lg font-bold text-white ${titleMarginClass}">${processedTitle}</h3>
                            </div>
                            <p class="text-gray-300">${processedText}</p>
                        `;
                    }
                };

                syncArea.addEventListener('mouseover', e => {
                    const target = e.target.closest('.highlightable, .node-content');
                    if (target) {
                        highlightPair(target.id);
                    }
                });
                syncArea.addEventListener('mouseleave', () => highlightPair(null));
            };

            // --- Data Definitions ---
            const simpleDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (Statement)', text: 'コンピュータに対する一つの「命令」です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'simple-struct-statement', astId: 'simple-ast-statement' },
                'expression': { badge: '式', badgeClass: 'badge-expression', title: '式 (CallExpression)', text: '関数を呼び出す「式」です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'simple-struct-expression', astId: 'simple-ast-expression' },
                'member-expression': { badge: '式', badgeClass: 'badge-expression', title: '式 (MemberExpression)', text: 'オブジェクトのメンバーにアクセスする「式」です。', highlightClass: 'highlight-member-expression', color: '#9F7AEA', structId: 'simple-struct-member-expression', astId: 'simple-ast-member-expression' },
                'identifier-console': { title: '識別子 (Identifier)', text: '`console` という名前のオブジェクトを指します。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'simple-struct-identifier-console', astId: 'simple-ast-identifier-console' },
                'identifier-log': { title: '識別子 (Identifier)', text: '`log` という名前のメンバーを指します。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'simple-struct-identifier-log', astId: 'simple-ast-identifier-log' },
                'literal': { title: 'リテラル (Literal)', text: 'ソースコードに直接書かれた値そのものです。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'simple-struct-literal', astId: 'simple-ast-literal' },
                'callee': { badge: '式', badgeClass: 'badge-expression', title: '式: 呼び出すもの (Callee)', text: '呼び出される関数を特定するための式です。ここでは `console.log` という `MemberExpression` (メンバーアクセス式) が該当します。この式が評価された結果（関数）が、続く引数と共に実行されます。', highlightClass: 'highlight-member-expression', color: '#9F7AEA', structId: 'simple-struct-member-expression', astId: 'simple-ast-callee' },
                'arguments': { title: '役割: 引数 (Arguments)', text: '関数に渡される値のリストです。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'simple-struct-literal', astId: 'simple-ast-arguments' },
            };
            setupInteractiveArea('interactive-sync-area-simple', simpleDefinitions);

            const ifDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (IfStatement)', text: '条件に応じて処理を分岐させる命令全体です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'if-struct-statement', astId: 'if-ast-statement' },
                'keyword-if': { title: 'キーワード `if`', text: '条件分岐を開始する合図です。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'if-struct-keyword-if', astId: 'if-ast-statement' },
                'test1': { badge: '式', badgeClass: 'badge-expression', title: '条件式 (Test)', text: '最初の条件 `score >= 80` です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'if-struct-test1', astId: 'if-ast-test1' },
                'consequent1': { title: '実行ブロック (Consequent)', text: '最初の条件がtrueの場合に実行される処理のかたまりです。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'if-struct-consequent1', astId: 'if-ast-consequent1' },
                'alternate': { badge: '節', badgeClass: 'badge-clause', title: '代替節 (Alternate)', text: '最初の条件がfalseだった場合の、次の分岐処理全体を指します。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'if-struct-alternate', astId: 'if-ast-alternate' },
                'keyword-else-if': { title: 'キーワード `else if`', text: '前の条件がfalseだった場合に、新たな条件で分岐する合図です。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'if-struct-keyword-else-if', astId: 'if-ast-alternate' },
                'test2': { badge: '式', badgeClass: 'badge-expression', title: '条件式 (Test)', text: '2番目の条件 `score >= 60` です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'if-struct-test2', astId: 'if-ast-test2' },
                'consequent2': { title: '実行ブロック (Consequent)', text: '2番目の条件がtrueの場合に実行される処理です。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'if-struct-consequent2', astId: 'if-ast-consequent2' },
                'alternate-final-group': { badge: '節', badgeClass: 'badge-clause', title: '最終代替節', text: '`else` 以下の部分です。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'if-struct-alternate-final-group', astId: 'if-ast-final-alternate' },
                'keyword-else': { title: 'キーワード `else`', text: 'どの条件にも当てはまらなかった場合に実行する処理を開始する合図です。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'if-struct-keyword-else', astId: 'if-ast-final-alternate' },
                'final-alternate': { title: '最終実行ブロック (Alternate)', text: 'どの条件にも当てはまらなかった場合に実行される処理です。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'if-struct-final-alternate', astId: 'if-ast-final-alternate' },
            };
            setupInteractiveArea('if-statement', ifDefinitions);

            const forDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (ForStatement)', text: '指定した回数だけ処理を繰り返す命令全体です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'for-struct-statement', astId: 'for-ast-statement' },
                'keyword': { title: 'キーワード `for`', text: '繰り返し処理を開始する合図です。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'for-struct-keyword', astId: 'for-ast-statement' },
                'init': { badge: '式', badgeClass: 'badge-expression', title: '初期化式 (Init)', text: 'ループが始まる前に一度だけ実行されます。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'for-struct-init', astId: 'for-ast-init' },
                'test': { badge: '式', badgeClass: 'badge-expression', title: '条件式 (Test)', text: 'ループを続ける条件です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'for-struct-test', astId: 'for-ast-test' },
                'update': { badge: '式', badgeClass: 'badge-expression', title: '更新式 (Update)', text: '各回の処理が終わった後に実行されます。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'for-struct-update', astId: 'for-ast-update' },
                'body': { title: '実行ブロック (Body)', text: 'ループ中に繰り返し実行される処理のかたまりです。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'for-struct-body', astId: 'for-ast-body' },
            };
            setupInteractiveArea('for-loop', forDefinitions);

            const switchDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (SwitchStatement)', text: 'ある値に応じて処理を多岐に分岐させる命令全体です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'switch-struct-statement', astId: 'switch-ast-statement' },
                'keyword-switch': { title: 'キーワード `switch`', text: '多岐分岐を開始する合図です。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-keyword-switch', astId: 'switch-ast-statement' },
                'discriminant': { badge: '式', badgeClass: 'badge-expression', title: '評価式 (Discriminant)', text: 'どのケースに分岐するかの基準となる値や変数です。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'switch-struct-discriminant', astId: 'switch-ast-discriminant' },
                'case1': { badge: '節', badgeClass: 'badge-clause', title: 'ケース節 (SwitchCase)', text: '評価式の値が `\'apple\'` だった場合の分岐です。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'switch-struct-case1', astId: 'switch-ast-case1' },
                'keyword-case1': { title: 'キーワード `case`', text: '分岐の選択肢を定義します。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-keyword-case1', astId: 'switch-ast-case1' },
                'test1': { badge: '式', badgeClass: 'badge-expression', title: 'テスト式 (Test)', text: 'このケースに一致するかを調べるための値です。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'switch-struct-test1', astId: 'switch-ast-test1' },
                'break1': { badge: '文', badgeClass: 'badge-statement', title: '文 (BreakStatement)', text: 'switch文の処理をここで中断し、抜け出します。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-break1', astId: 'switch-ast-break1' },
                'case2': { badge: '節', badgeClass: 'badge-clause', title: 'ケース節 (SwitchCase)', text: '評価式の値が `\'orange\'` だった場合の分岐です。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'switch-struct-case2', astId: 'switch-ast-case2' },
                'keyword-case2': { title: 'キーワード `case`', text: '分岐の選択肢を定義します。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-keyword-case2', astId: 'switch-ast-case2' },
                'test2': { badge: '式', badgeClass: 'badge-expression', title: 'テスト式 (Test)', text: 'このケースに一致するかを調べるための値です。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'switch-struct-test2', astId: 'switch-ast-test2' },
                'break2': { badge: '文', badgeClass: 'badge-statement', title: '文 (BreakStatement)', text: 'switch文の処理をここで中断し、抜け出します。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-break2', astId: 'switch-ast-break2' },
                'default': { badge: '節', badgeClass: 'badge-clause', title: 'デフォルト節 (SwitchCase)', text: 'どのケースにも一致しなかった場合に実行されます。', highlightClass: 'highlight-clause', color: '#ED64A6', structId: 'switch-struct-default', astId: 'switch-ast-default' },
                'keyword-default': { title: 'キーワード `default`', text: '一致するcaseがなかった場合の処理を定義します。', highlightClass: 'highlight-keyword', color: '#ECC94B', structId: 'switch-struct-keyword-default', astId: 'switch-ast-default' },
            };
            setupInteractiveArea('switch-statement', switchDefinitions);

            // --- Advanced tab definitions ---
            const chainedDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (ExpressionStatement)', text: 'メソッドチェーンを含む式文です。複数のメソッドを連鎖的に呼び出しています。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'chained-struct-statement', astId: 'chained-ast-statement' },
                'full-expression': { badge: '式', badgeClass: 'badge-expression', title: 'メソッドチェーン全体 (CallExpression)', text: '最外側のmap()呼び出しです。filter()の戻り値（配列）に対してmap()を実行しています。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'chained-struct-full-expression', astId: 'chained-ast-full-expression' },
                'object': { title: '元の配列 (Identifier)', text: 'メソッドチェーンの起点となる配列オブジェクトです。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'chained-struct-object', astId: 'chained-ast-object' },
                'filter-call': { badge: '式', badgeClass: 'badge-expression', title: 'filter()呼び出し (CallExpression)', text: '配列から条件に合う要素だけを抽出するメソッドです。新しい配列を返します。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'chained-struct-filter-call', astId: 'chained-ast-filter' },
                'filter-member': { badge: '式', badgeClass: 'badge-expression', title: 'filter()メンバーアクセス (MemberExpression)', text: 'usersオブジェクトのfilterメソッドへのアクセスです。', highlightClass: 'highlight-member-expression', color: '#9F7AEA', structId: 'chained-struct-filter-member', astId: 'chained-ast-filter-callee' },
                'filter-arg': { title: 'filter()の引数 (ArrowFunction)', text: '各要素をテストする関数（アロー関数）です。activeプロパティがtrueの要素のみを通します。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'chained-struct-filter-arg', astId: 'chained-ast-filter-arg' },
                'map-member': { title: 'map()メソッド (Identifier)', text: 'filter結果のmapメソッド名です。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'chained-struct-map-member', astId: 'chained-ast-map-property' },
                'map-arg': { title: 'map()の引数 (ArrowFunction)', text: '各要素を変換する関数です。ユーザーオブジェクトからnameプロパティだけを取り出します。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'chained-struct-map-arg', astId: 'chained-ast-map-arg' },
                'filter-property': { title: 'filter プロパティ (Identifier)', text: 'usersオブジェクトのfilterプロパティを指します。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'chained-struct-filter-property', astId: 'chained-ast-filter-property' },
                'map-callee': { badge: '式', badgeClass: 'badge-expression', title: 'map()メンバーアクセス (MemberExpression)', text: 'filter結果のmapメソッドへのアクセスです。', highlightClass: 'highlight-member-expression', color: '#9F7AEA', structId: 'chained-struct-map-callee', astId: 'chained-ast-map-callee' },
            };
            setupInteractiveArea('chained-calls', chainedDefinitions);

            const higherDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (ExpressionStatement)', text: '高階関数の戻り値（関数）を即座に呼び出している式文です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'higher-struct-statement', astId: 'higher-ast-statement' },
                'full-expression': { badge: '式', badgeClass: 'badge-expression', title: '関数呼び出し (CallExpression)', text: 'getEventHandler()が返した関数を即座に実行しています。calleeが式（関数呼び出し）になっているのが特徴です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'higher-struct-full-expression', astId: 'higher-ast-full-expression' },
                'callee': { badge: '式', badgeClass: 'badge-expression', title: '呼び出される関数 (CallExpression)', text: 'getEventHandler()の戻り値である関数が、実際に呼び出される対象です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'higher-struct-callee', astId: 'higher-ast-callee' },
                'get-handler': { title: 'getEventHandler関数 (Identifier)', text: 'イベントタイプに応じた適切なハンドラー関数を返す高階関数の名前です。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'higher-struct-get-handler', astId: 'higher-ast-get-handler' },
                'handler-arg': { title: 'ハンドラー取得の引数 (Literal)', text: 'どのタイプのイベントハンドラーが欲しいかを指定する文字列です。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'higher-struct-handler-arg', astId: 'higher-ast-handler-arg' },
                'event-arg': { title: 'イベント引数 (Identifier)', text: '取得したハンドラー関数に渡すイベントオブジェクトです。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'higher-struct-event-arg', astId: 'higher-ast-event-arg' },
            };
            setupInteractiveArea('higher-order', higherDefinitions);

            const dynamicDefinitions = {
                'statement': { badge: '文', badgeClass: 'badge-statement', title: '文 (ExpressionStatement)', text: '動的プロパティアクセスと関数呼び出しを組み合わせた式文です。', highlightClass: 'highlight-statement', color: '#F6E05E', structId: 'dynamic-struct-statement', astId: 'dynamic-ast-statement' },
                'full-expression': { badge: '式', badgeClass: 'badge-expression', title: '動的メソッド呼び出し (CallExpression)', text: '計算されたプロパティ名を使ってメソッドを呼び出しています。実行時に決まるメソッド名に対応できます。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'dynamic-struct-full-expression', astId: 'dynamic-ast-full-expression' },
                'object': { title: '対象オブジェクト (Identifier)', text: 'メソッドを呼び出す対象のオブジェクトです。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'dynamic-struct-object', astId: 'dynamic-ast-object' },
                'property': { badge: '式', badgeClass: 'badge-expression', title: 'プロパティ名の式 (BinaryExpression)', text: '文字列の連結でメソッド名を動的に生成しています。"get" + "Name" = "getName"のような形です。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'dynamic-struct-property', astId: 'dynamic-ast-property' },
                'method-name': { title: 'メソッド名プレフィックス (Literal)', text: 'getter メソッドの共通プレフィックス "get" です。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'dynamic-struct-method-name', astId: 'dynamic-ast-method-name' },
                'capitalize': { badge: '式', badgeClass: 'badge-expression', title: 'capitalize()呼び出し (CallExpression)', text: 'フィールド名の先頭を大文字にする関数です。"name" → "Name" のような変換を行います。', highlightClass: 'highlight-expression', color: '#68D391', structId: 'dynamic-struct-capitalize', astId: 'dynamic-ast-capitalize' },
                'field-arg': { title: 'フィールド名 (Identifier)', text: '動的にアクセスしたいプロパティの基本名です。これがcapitalizeされてメソッド名の一部になります。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'dynamic-struct-field-arg', astId: 'dynamic-ast-field-arg' },
                'callee': { badge: '式', badgeClass: 'badge-expression', title: 'MemberExpression (computed)', text: '動的にプロパティアクセスするMemberExpressionです。computedプロパティがtrueになります。', highlightClass: 'highlight-member-expression', color: '#9F7AEA', structId: 'dynamic-struct-callee', astId: 'dynamic-ast-callee' },
                'capitalize-callee': { title: 'capitalize関数 (Identifier)', text: 'capitalize関数を指すIdentifierです。', highlightClass: 'highlight-identifier', color: '#4FD1C5', structId: 'dynamic-struct-capitalize-callee', astId: 'dynamic-ast-capitalize-callee' },
                'arguments': { title: '関数の引数 (Array)', text: '動的に生成されたメソッドに渡す引数のリストです。この例では数値42を渡しています。', highlightClass: 'highlight-literal', color: '#F6AD55', structId: 'dynamic-struct-arguments', astId: 'dynamic-ast-arguments' },
            };
            setupInteractiveArea('dynamic-access', dynamicDefinitions);

            // Initialize the first advanced tab on page load
            setupInteractiveArea('chained-calls', chainedDefinitions);

            // --- Tab logic ---
            const tabs = document.querySelectorAll('.tab-button');
            const tabPanes = document.querySelectorAll('.tab-pane');
            const advancedTabs = document.querySelectorAll('.tab-button-advanced');
            const advancedTabPanes = document.querySelectorAll('.advanced-tab-pane');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const targetPaneId = tab.getAttribute('data-tab');
                    tabPanes.forEach(pane => {
                        pane.classList.toggle('active', pane.id === targetPaneId);
                    });
                });
            });

            advancedTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    advancedTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const targetPaneId = tab.getAttribute('data-tab');
                    advancedTabPanes.forEach(pane => {
                        pane.classList.toggle('active', pane.id === targetPaneId);
                        // Re-setup interactive areas when switching tabs
                        if (pane.classList.contains('active')) {
                            if (pane.id === 'chained-calls') setupInteractiveArea('chained-calls', chainedDefinitions);
                            if (pane.id === 'higher-order') setupInteractiveArea('higher-order', higherDefinitions);
                            if (pane.id === 'dynamic-access') setupInteractiveArea('dynamic-access', dynamicDefinitions);
                        }
                    });
                });
            });
        });
    </script>
</body>
</html>
